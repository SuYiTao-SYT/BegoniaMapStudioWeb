body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: #f4f4f9; height: 100vh; overflow: hidden; }

.container { display: flex; height: 100%; width: 100%; }

/* === 左侧栏 === */
.sidebar {
    width: 300px; background: white; padding: 20px;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    display: flex; flex-direction: column; gap: 20px; z-index: 20; /* 提高层级 */
    flex-shrink: 0;
}
h1 { color: #333; font-size: 24px; margin-top: 0; }
h3 { font-size: 16px; color: #666; margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
.card { background: #fff; }
.form-group { margin-bottom: 15px; }
label { display: block; font-size: 14px; margin-bottom: 5px; color: #555; }
input[type="text"], select, input[type="file"] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;}
button#renderBtn {
    width: 100%; padding: 12px; background: #3366CC; color: white; border: none;
    border-radius: 4px; cursor: pointer; font-size: 16px; transition: 0.2s;
}
button#renderBtn:hover { background: #254db3; }
.btn-download {
    display: block; width: 100%; padding: 12px; background: #28a745; color: white;
    text-align: center; text-decoration: none; border-radius: 4px; box-sizing: border-box;
}

/* === 中间：预览区 (视口) === */
.preview-area {
    flex: 1;
    background: #e0e0e0;
    position: relative;
    overflow: hidden; /* 隐藏溢出 */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: grab;
}
.preview-area:active { cursor: grabbing; }

/* 实际的 SVG 容器 */
.svg-wrapper {
    background: white;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
    
    /* === 核心修正：必须设为 0 0，否则 JS 算的坐标会对不上 === */
    transform-origin: 0 0; 
    
    transition: transform 0.05s linear; 
    width: 90%; 
    min-width: 600px;
    display: flex;
    justify-content: center;
    will-change: transform;
    contain: layout paint style;
    backface-visibility: hidden;
}

#svgContainer svg {
    width: 100% !important;
    height: auto !important;
    display: block;
    background-color: white;
    pointer-events: auto;
    
    /* 默认开启抗锯齿，线条平滑 */
    shape-rendering: geometricPrecision; 
}

/* === 新增：高性能模式 === */
/* 当容器拥有 .fast-mode 类时，强制切换渲染模式 */
#svgContainer.fast-mode svg {
    /* 牺牲画质(边缘有锯齿)，换取极速渲染 */
    shape-rendering: optimizeSpeed !important; 
    
    /* 可选：关闭文本抗锯齿，进一步提速 */
    text-rendering: optimizeSpeed !important; 
    
    /* 可选：简化合成运算 */
    image-rendering: pixelated;
}
/* 缩放控制器 */
.zoom-controls {
    position: absolute; bottom: 20px; left: 20px;
    display: flex; gap: 5px; z-index: 100;
}
.zoom-controls button {
    width: 36px; height: 36px; background: white; border: 1px solid #ccc;
    border-radius: 4px; font-size: 18px; cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.zoom-controls button:hover { background: #f0f0f0; }

/* === 右侧：编辑面板 === */
.editor-panel {
    width: 0; background: white; border-left: 1px solid #ddd;
    box-shadow: -2px 0 10px rgba(0,0,0,0.05);
    transition: width 0.25s cubic-bezier(0.2, 0, 0, 1);
    overflow: hidden; display: flex; flex-direction: column; flex-shrink: 0;
    z-index: 15;
}
.editor-panel.open { width: 380px; } /* 稍微加宽一点给滑条 */

.panel-header {
    padding: 15px 20px; background: #f8f8f8; border-bottom: 1px solid #eee;
    display: flex; justify-content: space-between; align-items: center;
    white-space: nowrap;
}
.panel-header h3 { margin: 0; }
.panel-header button { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }

.panel-content {
    padding: 20px; overflow-y: auto; flex: 1; min-width: 360px;
}

/* === 编辑控件样式 === */
.control-bar {
    display: flex; align-items: center; justify-content: flex-end;
    margin-bottom: 15px; font-size: 13px; color: #555;
    background: #f0f0f0; padding: 8px; border-radius: 4px;
}
.vote-row {
    background: #f9f9f9; border: 1px solid #eee; border-radius: 6px;
    padding: 10px; margin-bottom: 12px; display: flex; flex-direction: column; gap: 8px;
}
.row-top { display: flex; justify-content: space-between; align-items: center; }
.vote-name { font-weight: bold; font-size: 14px; color: #333; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.vote-input { width: 70px; padding: 4px; border: 1px solid #ccc; border-radius: 4px; text-align: right; font-weight: bold; }

/* 修复滑条挤压问题 */
.row-bottom { display: flex; align-items: center; gap: 10px; width: 100%; }
.vote-slider { 
    flex: 1; /* 自动占据剩余空间 */
    cursor: pointer; height: 4px; min-width: 50px; 
}
.vote-percent { 
    width: 48px; /* 固定宽度，防止被挤没了 */
    min-width: 48px; /* 强制不许缩小 */
    text-align: right; font-size: 12px; color: #666; font-family: monospace; 
}

.btn-save { width: 100%; margin-top: 20px; background: #28a745; color: white; padding: 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
.btn-save:hover { background: #218838; }

/* Tooltip & Interactive */
path[data-rate] { cursor: pointer; transition: opacity 0.15s; }
path[data-rate]:hover { opacity: 0.8; stroke: #FFFF00 !important; stroke-width: 2px !important; }
.tooltip {
    position: absolute; background: rgba(0, 0, 0, 0.85); color: white;
    padding: 8px 12px; border-radius: 6px; font-size: 14px; pointer-events: none;
    display: none; z-index: 9999; box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}
.placeholder { padding: 50px; color: #999; }

/* === 视图切换器 === */
.view-switcher {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%); /* 居中 */
    background: white;
    padding: 5px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    gap: 5px;
    z-index: 100;
}

.view-switcher button {
    background: transparent;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    color: #666;
    cursor: pointer;
    transition: all 0.2s;
}

.view-switcher button:hover {
    background: #f0f0f0;
}

/* 激活状态 */
.view-switcher button.active {
    background: #333;
    color: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* === 多选高亮样式 === */
/* 原元素被选中时，本身不需要变，或者只需轻微变暗/变亮 */
.selected-source {
    /* 可选：原元素轻微变色，作为底色 */
    opacity: 1.0;
}

/* 替身样式 (在最顶层) */
.highlight-clone {
    /* 1. 填充透明 */
    fill: none !important; 
    
    /* 2. 描边：纯白，细致一点 */
    stroke: #ffffff !important; 
    stroke-width: 2.5px !important; /* 改细一点，更精致 */
    
    /* 3. 滤镜：改为"悬浮投影"而非"霓虹发光" */
    /* drop-shadow(偏移X 偏移Y 模糊度 颜色) */
    /* 这里加了一个黑色的投影，让选区看起来"浮"在地图上方，立体感强，但不刺眼 */
    filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.6));
    
    /* 4. 交互穿透 */
    pointer-events: none;
    
    /* 5. 动画：改为非常缓慢的"呼吸"效果，或者直接去掉 */
    /* 如果觉得完全静止太死板，可以保留这个微弱的呼吸 */
    animation: gentle-breath 3s infinite ease-in-out;
}

@keyframes gentle-breath {
    0% { stroke-opacity: 0.8; stroke-width: 2.5px; }
    50% { stroke-opacity: 1.0; stroke-width: 3.5px; } /* 稍微变粗一点点 */
    100% { stroke-opacity: 0.8; stroke-width: 2.5px; }
}

/* 编辑模式切换 */
.editor-mode-section {
    animation: fadeIn 0.2s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* 批量面板样式 */
.batch-info-box {
    padding: 15px;
    background: #f0f8ff;
    border-radius: 6px;
    border: 1px solid #cceeff;
    margin-bottom: 20px;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: bold;
    color: #333;
}
.checkbox-group input {
    width: auto;
    margin-right: 8px;
}

.slider-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 5px;
}
.slider-wrapper input { flex: 1; }
.small-text { font-size: 12px; color: #666; }
.help-text { font-size: 12px; color: #888; margin-top: 8px; line-height: 1.4; }